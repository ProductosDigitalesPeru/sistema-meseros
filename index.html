<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Mesas</title>

<style>

body{
margin:0;
font-family:Arial, sans-serif;
background:#0f0f0f;
color:white;
}

h1{
text-align:center;
padding:15px;
margin:0;
background:#000;
font-size:18px;
}

.leyenda{
display:flex;
justify-content:space-around;
padding:10px;
background:#111;
font-size:13px;
}

.leyenda div{
display:flex;
align-items:center;
gap:6px;
}

.color{
width:15px;
height:15px;
border-radius:4px;
}

#mesas{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
padding:10px;
}

.mesa{
padding:20px;
border-radius:10px;
text-align:center;
font-weight:bold;
cursor:pointer;
}

.sin_atender{background:#f9a825;}
.tomado{background:#ef6c00;}
.atendido{background:#1565c0;}
.pagado{background:#6a1b9a;}

#pedido{
display:none;
padding:15px;
}

button{
width:100%;
padding:12px;
margin:5px 0;
border:none;
border-radius:8px;
font-size:14px;
cursor:pointer;
font-weight:bold;
}

button.sin_atender{ background:#f9a825; color:black; }
button.tomado{ background:#ef6c00; color:white; }
button.atendido{ background:#1565c0; color:white; }
button.pagado{ background:#6a1b9a; color:white; }

button:hover{opacity:0.9;}

input{
width:100%;
padding:10px;
margin:10px 0;
border-radius:8px;
border:none;
}

.categoria{
background:#222;
padding:8px;
margin:8px 0;
border-radius:6px;
cursor:pointer;
}

.producto{
display:flex;
justify-content:space-between;
align-items:center;
margin:5px 0;
font-size:14px;
}

.total{
margin-top:10px;
font-size:18px;
font-weight:bold;
}

.eliminar{
background:#c62828;
padding:5px 8px;
font-size:12px;
border-radius:5px;
}

.volver{
background:#000;
color:white;
border:1px solid white;
}

</style>
</head>

<body>

<h1>Sistema Mesas</h1>

<div class="leyenda">
<div><div class="color" style="background:#f9a825"></div> Sin atender</div>
<div><div class="color" style="background:#ef6c00"></div> Pedido tomado</div>
<div><div class="color" style="background:#1565c0"></div> Atendido</div>
</div>

<div id="mesas"></div>

<div id="pedido">

<h2 id="tituloMesa"></h2>

<h3>Estado de la Mesa</h3>

<button class="sin_atender" onclick="cambiarEstado('sin_atender')">Sin Atender</button>
<button class="tomado" onclick="cambiarEstado('tomado')">Pedido Tomado</button>
<button class="atendido" onclick="cambiarEstado('atendido')">Atendido</button>
<button class="pagado" onclick="cambiarEstado('pagado')">Pagado</button>

<input type="text" id="buscador" placeholder="Buscar plato..." onkeyup="buscarPlato()">

<div id="categorias"></div>

<h3>Pedido</h3>
<div id="listaPedido"></div>

<div class="total">Total: S/ <span id="total">0</span></div>

<button class="volver" onclick="volverMesas()">Volver</button>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>

var firebaseConfig = {
  apiKey: "AIzaSyA8v5XCmOIwUwFa0-fRcNFh-i1gAGQsNfI",
  authDomain: "sistema-meseros.firebaseapp.com",
  databaseURL: "https://sistema-meseros-default-rtdb.firebaseio.com",
  projectId: "sistema-meseros",
  storageBucket: "sistema-meseros.firebasestorage.app",
  messagingSenderId: "35929303202",
  appId: "1:35929303202:web:c787500b3117443d4dcffb"
};

firebase.initializeApp(firebaseConfig);
var database = firebase.database();

let mesaActual = null;

// Inicializar 13 mesas si no existen
database.ref("mesas").once("value", function(snapshot){
    if(!snapshot.exists()){
        for(let i=1; i<=13; i++){
            database.ref("mesas/"+i).set({
                estado: "sin_atender",
                pedido: {},
                total: 0
            });
        }
    }
});

// Cargar mesas en tiempo real
function cargarMesas(){
database.ref("mesas").on("value", snapshot=>{
let data = snapshot.val() || {};
let contenedor = document.getElementById("mesas");
contenedor.innerHTML="";
for(let i=1;i<=13;i++){
let estado = data[i]?.estado || "sin_atender";
contenedor.innerHTML+=`<div class="mesa ${estado}" onclick="abrirMesa(${i})">Mesa ${i}</div>`;
}
});
}

function abrirMesa(num){
mesaActual = num;
document.getElementById("mesas").style.display="none";
document.getElementById("pedido").style.display="block";
document.getElementById("tituloMesa").innerText="Mesa "+num;
cargarPedido();
cargarCategorias();
}

function volverMesas(){
document.getElementById("pedido").style.display="none";
document.getElementById("mesas").style.display="grid";
}

function cambiarEstado(nuevoEstado){

if(nuevoEstado === "pagado"){

if(confirm("¿Seguro que deseas cerrar esta mesa?")){

database.ref("mesas/"+mesaActual+"/pedido").remove();
database.ref("mesas/"+mesaActual+"/total").set(0);
database.ref("mesas/"+mesaActual+"/estado").set("sin_atender");

alert("Mesa cerrada correctamente ✔");

volverMesas();
}

}else{
database.ref("mesas/"+mesaActual+"/estado").set(nuevoEstado);
}
}

let platos = {
"Ceviches":[
{nombre:"Ceviche Clásico",precio:26},
{nombre:"Ceviche Mixto",precio:32}
],
"Arroces":[
{nombre:"Arroz con Mariscos",precio:28}
],
"Bebidas":[
{nombre:"Limonada",precio:12}
]
};

function cargarCategorias(){
let cont = document.getElementById("categorias");
cont.innerHTML="";
for(let cat in platos){
cont.innerHTML+=`<div class="categoria" onclick="mostrarPlatos('${cat}')">${cat}</div>`;
}
}

function mostrarPlatos(cat){
let cont = document.getElementById("categorias");
cont.innerHTML="";
platos[cat].forEach(p=>{
cont.innerHTML+=`<button onclick="agregarPlato('${p.nombre}',${p.precio})">${p.nombre} - S/${p.precio}</button>`;
});
}

function agregarPlato(nombre,precio){
database.ref("mesas/"+mesaActual+"/pedido").push({
nombre:nombre,
precio:precio
});
}

function cargarPedido(){
database.ref("mesas/"+mesaActual+"/pedido").on("value", snapshot=>{
let data = snapshot.val() || {};
let lista = document.getElementById("listaPedido");
let total = 0;
lista.innerHTML="";
for(let key in data){
total += data[key].precio;
lista.innerHTML+=`
<div class="producto">
${data[key].nombre} - S/${data[key].precio}
<button class="eliminar" onclick="eliminar('${key}')">X</button>
</div>`;
}
document.getElementById("total").innerText=total;
});
}

function eliminar(key){
database.ref("mesas/"+mesaActual+"/pedido/"+key).remove();
}

function buscarPlato(){
let texto = document.getElementById("buscador").value.toLowerCase();
let cont = document.getElementById("categorias");
cont.innerHTML="";
for(let cat in platos){
platos[cat].forEach(p=>{
if(p.nombre.toLowerCase().includes(texto)){
cont.innerHTML+=`<button onclick="agregarPlato('${p.nombre}',${p.precio})">${p.nombre} - S/${p.precio}</button>`;
}
});
}
}

cargarMesas();

</script>

</body>
</html>
