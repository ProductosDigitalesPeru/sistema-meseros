<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Meseros</title>

<style>
body{
margin:0;
font-family:Arial, sans-serif;
background:#0f0f0f;
color:white;
}

h1{
text-align:center;
padding:15px;
margin:0;
background:#000;
font-size:18px;
}

#mesas{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
padding:10px;
}

.mesa{
padding:20px;
border-radius:10px;
text-align:center;
font-size:16px;
cursor:pointer;
}

.libre{background:#2e7d32;}
.sin_atender{background:#f9a825;}
.tomado{background:#ef6c00;}
.cocina{background:#c62828;}
.atendido{background:#1565c0;}
.pagar{background:#6a1b9a;}
.pagado{background:#424242;}

#pedido{
display:none;
padding:15px;
}

button{
width:100%;
padding:12px;
margin:5px 0;
border:none;
border-radius:8px;
font-size:14px;
cursor:pointer;
}

.producto{
display:flex;
justify-content:space-between;
margin:5px 0;
font-size:14px;
}

.total{
margin-top:10px;
font-size:18px;
font-weight:bold;
}

.select-estado{
width:100%;
padding:10px;
margin:10px 0;
border-radius:8px;
}

.volver{
background:#000;
color:white;
border:1px solid white;
}
</style>
</head>

<body>

<h1>Sistema Mesas</h1>

<div id="mesas"></div>

<div id="pedido">

<h2 id="tituloMesa"></h2>

<select class="select-estado" onchange="cambiarEstado(this.value)">
<option value="sin_atender">Sin atender</option>
<option value="tomado">Pedido tomado</option>
<option value="cocina">En cocina</option>
<option value="atendido">Atendido</option>
<option value="pagar">Por pagar</option>
<option value="pagado">Pagado</option>
</select>

<h3>Agregar Productos</h3>

<button onclick="agregarProducto('Ceviche',26)">Ceviche S/26</button>
<button onclick="agregarProducto('Arroz',26)">Arroz S/26</button>
<button onclick="agregarProducto('Limonada',12)">Limonada S/12</button>

<h3>Pedido</h3>
<div id="listaPedido"></div>

<div class="total">Total: S/ <span id="total">0</span></div>

<button onclick="cerrarMesa()">Cerrar Mesa</button>
<button class="volver" onclick="volverMesas()">Volver</button>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
apiKey: "AIzaSyA8v5XCmOIwUwFa0-fRcNFh-i1gAGQsNfI",
authDomain: "sistema-meseros.firebaseapp.com",
databaseURL: "https://sistema-meseros-default-rtdb.firebaseio.com",
projectId: "sistema-meseros",
storageBucket: "sistema-meseros.firebasestorage.app",
messagingSenderId: "35929303202",
appId: "1:35929303202:web:c787500b3117443d4dcffb"
};

firebase.initializeApp(firebaseConfig);
var database = firebase.database();

let mesaActual = null;

function crearMesas(){
for(let i=1;i<=13;i++){
database.ref("mesas/"+i).once("value", snapshot=>{
if(!snapshot.exists()){
database.ref("mesas/"+i).set({
estado:"libre",
total:0,
productos:[]
});
}
});
}
}

function renderMesas(){
database.ref("mesas").on("value", snapshot=>{
const contenedor=document.getElementById("mesas");
contenedor.innerHTML="";
snapshot.forEach(child=>{
let mesa=child.val();
let div=document.createElement("div");
div.className="mesa "+mesa.estado;
div.innerHTML="Mesa "+child.key+"<br>S/ "+mesa.total;
div.onclick=()=>abrirMesa(child.key);
contenedor.appendChild(div);
});
});
}

function abrirMesa(numero){
mesaActual=numero;
document.getElementById("mesas").style.display="none";
document.getElementById("pedido").style.display="block";
document.getElementById("tituloMesa").innerText="Mesa "+numero;

database.ref("mesas/"+numero).on("value", snapshot=>{
let mesa=snapshot.val();
document.getElementById("total").innerText=mesa.total;
let lista=document.getElementById("listaPedido");
lista.innerHTML="";
mesa.productos.forEach(p=>{
lista.innerHTML+=`<div class="producto">${p.nombre} - S/ ${p.precio}</div>`;
});
});
}

function agregarProducto(nombre,precio){
database.ref("mesas/"+mesaActual).once("value", snapshot=>{
let mesa=snapshot.val();
mesa.productos.push({nombre,precio});
mesa.total+=precio;
database.ref("mesas/"+mesaActual).set(mesa);
});
}

function cambiarEstado(estado){
database.ref("mesas/"+mesaActual+"/estado").set(estado);
}

function cerrarMesa(){
database.ref("mesas/"+mesaActual).set({
estado:"libre",
total:0,
productos:[]
});
volverMesas();
}

function volverMesas(){
document.getElementById("pedido").style.display="none";
document.getElementById("mesas").style.display="grid";
}

crearMesas();
renderMesas();
</script>

</body>
</html>


