<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Mesas</title>

<style>
body{
margin:0;
font-family:Arial;
background:#0f0f0f;
color:white;
}

h1{
text-align:center;
padding:15px;
margin:0;
background:#000;
font-size:18px;
}

.leyenda{
display:flex;
justify-content:space-around;
padding:10px;
background:#111;
font-size:13px;
}

.color{
width:15px;
height:15px;
border-radius:4px;
display:inline-block;
margin-right:5px;
}

#mesas{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
padding:10px;
}

.mesa{
padding:20px;
border-radius:10px;
text-align:center;
font-weight:bold;
cursor:pointer;
}

.sin_atender{background:#f9a825;} /* amarillo */
.tomado{background:#ef6c00;}
.atendido{background:#1565c0;}
.pagado{background:#6a1b9a;}

#pedido{
display:none;
padding:15px;
}

.estados{
display:grid;
grid-template-columns:1fr 1fr;
gap:8px;
margin-bottom:15px;
}

.estados button{
padding:8px;
font-size:13px;
border:none;
border-radius:8px;
font-weight:bold;
}

.activo{
outline:2px solid white;
}

.sin_btn{background:#f9a825;color:black;}
.tom_btn{background:#ef6c00;color:white;}
.ate_btn{background:#1565c0;color:white;}
.pag_btn{background:#6a1b9a;color:white;}

.estados button:disabled{
opacity:0.3;
}

input{
width:100%;
padding:10px;
margin:10px 0;
border-radius:8px;
border:none;
}

.categoria{
background:#222;
padding:8px;
margin:6px 0;
border-radius:6px;
cursor:pointer;
}

.plato{
display:flex;
justify-content:space-between;
padding:6px;
border-bottom:1px solid #333;
cursor:pointer;
}

.producto{
display:flex;
justify-content:space-between;
align-items:center;
margin:4px 0;
font-size:14px;
}

.eliminar{
background:#c62828;
font-size:10px;
padding:2px 6px;
border:none;
border-radius:4px;
cursor:pointer;
}

.total{
margin-top:10px;
font-size:18px;
font-weight:bold;
}

.volver{
background:#000;
color:white;
border:1px solid white;
padding:10px;
border-radius:8px;
margin-top:10px;
}

</style>
</head>

<body>

<h1>Sistema Mesas</h1>

<div class="leyenda">
<div><span class="color" style="background:#f9a825"></span>1 Sin atender</div>
<div><span class="color" style="background:#ef6c00"></span>2 Pedido tomado</div>
<div><span class="color" style="background:#1565c0"></span>3 Atendido</div>
<div><span class="color" style="background:#6a1b9a"></span>4 Pagado</div>
</div>

<div id="mesas"></div>

<div id="pedido">
<h2 id="tituloMesa"></h2>

<div class="estados">
<button id="btn1" class="sin_btn">1 Sin atender</button>
<button id="btn2" class="tom_btn" onclick="cambiarEstado(2)">2 Pedido tomado</button>
<button id="btn3" class="ate_btn" onclick="cambiarEstado(3)">3 Atendido</button>
<button id="btn4" class="pag_btn" onclick="cambiarEstado(4)">4 Pagado</button>
</div>

<input type="text" id="buscador" placeholder="Buscar plato..." onkeyup="buscarPlato()">

<div id="categorias"></div>

<h3>Pedido</h3>
<div id="listaPedido"></div>

<div class="total">Total: S/ <span id="total">0</span></div>

<button class="volver" onclick="volverMesas()">Volver</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>

var firebaseConfig = {
apiKey: "TU_API_KEY_AQUI",
authDomain: "TU_AUTH_DOMAIN",
databaseURL: "TU_DATABASE_URL",
projectId: "TU_PROJECT_ID",
};

firebase.initializeApp(firebaseConfig);
var database = firebase.database();

let mesaActual=null;
let estadoActual=1;

database.ref("mesas").once("value",function(snapshot){
if(!snapshot.exists()){
for(let i=1;i<=13;i++){
database.ref("mesas/"+i).set({
estado:1,
pedido:{}
});
}
}
});

function cargarMesas(){
database.ref("mesas").on("value",snapshot=>{
let data=snapshot.val()||{};
let cont=document.getElementById("mesas");
cont.innerHTML="";
for(let i=1;i<=13;i++){
let estado=data[i]?.estado||1;
let clase = estado==1?"sin_atender":
estado==2?"tomado":
estado==3?"atendido":"pagado";
cont.innerHTML+=`<div class="mesa ${clase}" onclick="abrirMesa(${i})">Mesa ${i}</div>`;
}
});
}

function abrirMesa(num){
mesaActual=num;
document.getElementById("mesas").style.display="none";
document.getElementById("pedido").style.display="block";
document.getElementById("tituloMesa").innerText="Mesa "+num;

database.ref("mesas/"+num+"/estado").once("value",snap=>{
estadoActual=snap.val()||1;
actualizarBotones();
});

cargarPedido();
cargarCategorias();
}

function actualizarBotones(){
for(let i=1;i<=4;i++){
let btn=document.getElementById("btn"+i);
btn.disabled=true;
btn.classList.remove("activo");
}

document.getElementById("btn"+estadoActual).classList.add("activo");

if(estadoActual<4){
document.getElementById("btn"+(estadoActual+1)).disabled=false;
}
}

function cambiarEstado(nuevo){
if(nuevo==4){
if(confirm("¿Confirmar pago y cerrar mesa?")){
database.ref("mesas/"+mesaActual+"/pedido").remove();
database.ref("mesas/"+mesaActual+"/estado").set(1);
volverMesas();
}
}else{
database.ref("mesas/"+mesaActual+"/estado").set(nuevo);
estadoActual=nuevo;
actualizarBotones();
}
}

function volverMesas(){
document.getElementById("pedido").style.display="none";
document.getElementById("mesas").style.display="grid";
}

let platos={
"Ceviches":[
{nombre:"Ceviche clásico",precio:26},
{nombre:"Ceviche mixto",precio:32}
],
"Chicharrones":[
{nombre:"Chicharrón de pescado",precio:28}
],
"Bebidas":[
{nombre:"Limonada",precio:12}
]
};

function cargarCategorias(){
let cont=document.getElementById("categorias");
cont.innerHTML="";
for(let categoria in platos){
cont.innerHTML+=`<div class="categoria" onclick="mostrarPlatos('${categoria}')">${categoria}</div>`;
}
}

function mostrarPlatos(cat){
let cont=document.getElementById("categorias");
cont.innerHTML="";
platos[cat].forEach(p=>{
cont.innerHTML+=`
<div class="plato" onclick="agregarProducto('${p.nombre}',${p.precio})">
<span>${p.nombre}</span>
<span>S/${p.precio}</span>
</div>`;
});
}

function agregarProducto(nombre,precio){
database.ref("mesas/"+mesaActual+"/pedido").push({
nombre:nombre,
precio:precio
});
}

function cargarPedido(){
database.ref("mesas/"+mesaActual+"/pedido").on("value",snap=>{
let data=snap.val()||{};
let lista=document.getElementById("listaPedido");
let total=0;
lista.innerHTML="";
for(let key in data){
total+=data[key].precio;
lista.innerHTML+=`
<div class="producto">
<span>${data[key].nombre} - S/${data[key].precio}</span>
<button class="eliminar" onclick="eliminar('${key}')">x</button>
</div>`;
}
document.getElementById("total").innerText=total;
});
}

function eliminar(key){
database.ref("mesas/"+mesaActual+"/pedido/"+key).remove();
}

cargarMesas();

</script>
</body>
</html>


